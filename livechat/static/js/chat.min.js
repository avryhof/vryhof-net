var API_RESULT_KEY="result";var API_GENERIC_FAILURE="bad";var API_GENERIC_SUCCESS="ok";var MOBILE_APP_AGENT="ErWsatQyfJ93y4TnzUbaPtRwVa62tXbuTGNspRx8MweHsPaRr7";var chat_dialog_visible=false;var session_continued=false;var chat_started=false;var message_div;function get_messages(a){$.ajax({url:"/livechat/get-messages/",method:"GET",headers:{"KPH-Agent":MOBILE_APP_AGENT},data:{continue_chat:a},success:function(b){results=b.result;for(var c in results){message_div.append('<div class="chat-message '+results[c].type+'"><strong>'+results[c].name+":</strong> "+results[c].message+"</div>")}message_div.stop().animate({scrollTop:message_div[0].scrollHeight*2},800)},error:function(b){console.log("ERROR:");console.log(b)}})}function send_message(){message=$("#chat-input").val();if(message){$.ajax({url:"/livechat/send-message/",method:"POST",headers:{"KPH-Agent":MOBILE_APP_AGENT},data:{message:message},success:function(a){$("#chat-input").val("");if(!chat_started){setInterval(get_messages,3000);chat_started=true}get_messages()},error:function(a){console.log("ERROR:");console.log(a)}})}}$(document).ready(function(){$("#chat-dialog").hide();message_div=$("#chat-messages");document.addEventListener("click",function(a){if(a.target.className=="chat-answer"){a.preventDefault();$("#chat-input").val(a.target.innerText);send_message()}});$("#chat-notifier").click(function(){if(!chat_dialog_visible){$("#chat-dialog").show("slow");chat_dialog_visible=true;if(!session_continued){session_continued=true;get_messages(session_continued)}}else{$("#chat-dialog").hide("slow");chat_dialog_visible=false}});$("#chat-send").click(function(a){a.preventDefault();send_message()});$("#chat-input").keyup(function(b){var a=b.key;if(a==="Enter"){b.preventDefault();send_message()}})});